<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4. Calculate bioclimatic variables and SDM • dsclimtools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4. Calculate bioclimatic variables and SDM">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsclimtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a1_dsclim_point_data.html">1. Use dsclim past data with point data</a></li>
    <li><a class="dropdown-item" href="../articles/a2_dsclim_past_to_future.html">2. Combine dsclim data from past to future</a></li>
    <li><a class="dropdown-item" href="../articles/a3_dsclim_maps.html">3. Analyse spatio-temporal patterns</a></li>
    <li><a class="dropdown-item" href="../articles/a4_bioclimatic_variables.html">4. Calculate bioclimatic variables and SDM</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dinilu/dsclimtools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>4. Calculate bioclimatic variables and SDM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dinilu/dsclimtools/blob/v0.0.0.900/vignettes/a4_bioclimatic_variables.Rmd" class="external-link"><code>vignettes/a4_bioclimatic_variables.Rmd</code></a></small>
      <div class="d-none name"><code>a4_bioclimatic_variables.Rmd</code></div>
    </div>

    
    
<p>It is standard practice in biogeography to derive new variables from
existing climatic data, as this makes it easier to interpret the data
ecologically. One example of this is the calculation of bioclimate
variables. Furthermore, these variables are typically employed as inputs
for ecological modelling tools, such as Species Distribution Models
(SDMs), which correlate them with species occurrences to estimate
potential distribution across an area of interest. In this example, we
have calculated a set of bioclimatic variables for the specified study
periods and used them to calibrate a Species Distribution Model (SDM)
which was projected into past conditions.</p>
<div class="section level2">
<h2 id="dependencies-and-functions">Dependencies and functions<a class="anchor" aria-label="anchor" href="#dependencies-and-functions"></a>
</h2>
<p>First, we load several packages and define a couple of functions to
convert the star object into a raster stack (we transform our data from
cube format into a stack to use typical functions of spatial analysis)
and to project SDMs into the bioclim variables at different time
periods.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dinilu/dsclimtools" class="external-link">dsclimtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster/sdm/" class="external-link">dismo</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">KnowBR</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stars_to_stack</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="va">i</span><span class="op">:</span><span class="op">(</span><span class="va">i</span><span class="op">+</span><span class="fl">11</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">rast</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model.projection</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">predictors_list</span>, <span class="va">land</span>, <span class="va">model</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">predictors</span> <span class="op">&lt;-</span> <span class="va">predictors_list</span><span class="op">[[</span><span class="va">p</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu">raster</span><span class="fu">::</span><span class="fu">mask</span><span class="op">(</span><span class="va">land</span><span class="op">)</span></span>
<span>  <span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">predictors</span>, </span>
<span>                        <span class="va">model</span>, </span>
<span>                        type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span>  <span class="va">prediction</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="defining-periods">Defining periods<a class="anchor" aria-label="anchor" href="#defining-periods"></a>
</h2>
<p>In order to load dsclim dataset, we define two periods of interest.
The first one is contemporary to be used when fitting SDMs. The second
one is past to project SDMs into a hindcasting exercise.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">present_start</span> <span class="op">&lt;-</span> <span class="fl">11</span></span>
<span><span class="va">present_end</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span></span>
<span><span class="va">past_start</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">14500</span></span>
<span><span class="va">past_end</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">14400</span></span></code></pre></div>
</div>
<div class="section level2 tabset tabset-pills">
<h2 class="tabset tabset-pills" id="load-downscaled-climatic-data-dsclim">Load downscaled climatic data
(dsclim)<a class="anchor" aria-label="anchor" href="#load-downscaled-climatic-data-dsclim"></a>
</h2>
<p>Now, we load the climatic data for the specified period and three
variables (e.g. maximum temperature, minimum temperature and
precipitation). The <code><a href="../reference/read_dsclim.html">read_dsclim()</a></code> function return a
<code>stars</code> object that we afterwards convert into a list of
raster stack (one for each year) using the <code>stars_to_stack</code>
function. The stacks include 12 layers, representing the twelve months
in each year.</p>
<p>We repeat the same for the two periods: present and past.</p>


<ul class="nav nav-pills" id="load-downscaled-climatic-data-dsclim" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#present" id="present-tab" type="button" role="tab" aria-controls="present" aria-selected="true" class="active nav-link">Present</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#past" id="past-tab" type="button" role="tab" aria-controls="past" aria-selected="false" class="nav-link">Past</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="present" role="tabpanel" aria-labelledby="present-tab">

<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">present_tmax</span> <span class="op">&lt;-</span> <span class="fu">dsclimtools</span><span class="fu">::</span><span class="fu"><a href="../reference/read_dsclim.html">read_dsclim</a></span><span class="op">(</span> <span class="st">"../data/dsclim"</span>, </span>
<span>                                          <span class="st">"tasmax"</span>,</span>
<span>                                          <span class="va">present_start</span>, </span>
<span>                                          <span class="va">present_end</span>, </span>
<span>                                          calendar_dates <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          proxy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">present_tmin</span> <span class="op">&lt;-</span> <span class="fu">dsclimtools</span><span class="fu">::</span><span class="fu"><a href="../reference/read_dsclim.html">read_dsclim</a></span><span class="op">(</span> <span class="st">"../data/dsclim"</span>,</span>
<span>                                          <span class="st">"tasmin"</span>,</span>
<span>                                          <span class="va">present_start</span>, </span>
<span>                                          <span class="va">present_end</span>, </span>
<span>                                          calendar_dates <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          proxy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">present_prec</span> <span class="op">&lt;-</span> <span class="fu">dsclimtools</span><span class="fu">::</span><span class="fu"><a href="../reference/read_dsclim.html">read_dsclim</a></span><span class="op">(</span> <span class="st">"../data/dsclim"</span>, </span>
<span>                                          <span class="st">"pr"</span>,</span>
<span>                                          <span class="va">present_start</span>, </span>
<span>                                          <span class="va">present_end</span>, </span>
<span>                                          calendar_dates <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          proxy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">present_tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">360</span>, by <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, </span>
<span>                       FUN <span class="op">=</span> <span class="va">stars_to_stack</span>, </span>
<span>                       <span class="va">present_tmax</span><span class="op">)</span></span>
<span></span>
<span><span class="va">present_tmin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">360</span>, by <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, </span>
<span>                       FUN <span class="op">=</span> <span class="va">stars_to_stack</span>, </span>
<span>                       <span class="va">present_tmin</span><span class="op">)</span></span>
<span></span>
<span><span class="va">present_prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">360</span>, by <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>                       FUN <span class="op">=</span> <span class="va">stars_to_stack</span>, </span>
<span>                       <span class="va">present_prec</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">present_tmax</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa4%2Fpresent_tmax.png" width="600" alt="Figure 1. Maximun temperature in 1961."><div class="figcaption">Figure 1. Maximun temperature in 1961.</div>
</div>
</div>
<div class="tab-pane" id="past" role="tabpanel" aria-labelledby="past-tab">

<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">past_tmax</span> <span class="op">&lt;-</span> <span class="fu">dsclimtools</span><span class="fu">::</span><span class="fu"><a href="../reference/read_dsclim.html">read_dsclim</a></span><span class="op">(</span> <span class="st">"../data/dsclim"</span>, </span>
<span>                                  <span class="st">"tasmax"</span>,</span>
<span>                                  <span class="va">past_start</span>, </span>
<span>                                  <span class="va">past_end</span>, </span>
<span>                                  calendar_dates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  proxy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_tmin</span> <span class="op">&lt;-</span> <span class="fu">dsclimtools</span><span class="fu">::</span><span class="fu"><a href="../reference/read_dsclim.html">read_dsclim</a></span><span class="op">(</span> <span class="st">"../data/dsclim"</span>, </span>
<span>                                  <span class="st">"tasmin"</span>,</span>
<span>                                  <span class="va">past_start</span>, </span>
<span>                                  <span class="va">past_end</span>, </span>
<span>                                  calendar_dates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  proxy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">past_prec</span> <span class="op">&lt;-</span> <span class="fu">dsclimtools</span><span class="fu">::</span><span class="fu"><a href="../reference/read_dsclim.html">read_dsclim</a></span><span class="op">(</span> <span class="st">"../data/dsclim"</span>,</span>
<span>                                  <span class="st">"pr"</span>,</span>
<span>                                  <span class="va">past_start</span>, </span>
<span>                                  <span class="va">past_end</span>, </span>
<span>                                  calendar_dates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  proxy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1212</span>, by <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, </span>
<span>               FUN <span class="op">=</span> <span class="va">stars_to_stack</span>, </span>
<span>               <span class="va">past_tmax</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_tmin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1212</span>, by <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, </span>
<span>               FUN <span class="op">=</span> <span class="va">stars_to_stack</span>, </span>
<span>               <span class="va">past_tmin</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1212</span>, by <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>               FUN <span class="op">=</span> <span class="va">stars_to_stack</span>, </span>
<span>               <span class="va">past_prec</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">past_tmax</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa4%2Fpast_tmax.png" width="600" alt="Figure 2. Maximun Temperature for 12500 years BP."><div class="figcaption">Figure 2. Maximun Temperature for 12500 years
BP.</div>
</div>
</div>
</div>
</div>
<div class="section level2 tabset tabset-pills">
<h2 class="tabset tabset-pills" id="calculate-bioclimatic-variables">Calculate bioclimatic variables<a class="anchor" aria-label="anchor" href="#calculate-bioclimatic-variables"></a>
</h2>
<p>We can calculate the 19 bioclimatic variables for each year in the
two periods. The result is, hence, stored as a list of raster stacks
with 19 layers (19 bioclimatic variables). For present, we calculate the
mean of the 19 variables across the 30 years of the period to create a
unique grid, which will then be used in model calibration.</p>
<p>Then, we selected the same subset of variables in both periods
following the same criteria than the tutorial in <a href="https://rspatial.org/raster/sdm/raster_SDM.pdf" class="external-link">https://rspatial.org/raster/sdm/raster_SDM.pdf</a>.
Note that our intent with this vignette is solely for illustrative
purposes. In actual modelling, it would be advisable to select variables
based on their ecological impact on the study species and their
correlation.</p>


<ul class="nav nav-pills" id="calculate-bioclimatic-variables" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#present-1" id="present-1-tab" type="button" role="tab" aria-controls="present-1" aria-selected="true" class="active nav-link">Present</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#past-1" id="past-1-tab" type="button" role="tab" aria-controls="past-1" aria-selected="false" class="nav-link">Past</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="present-1" role="tabpanel" aria-labelledby="present-1-tab">

<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">present_bio_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="fu">dismo</span><span class="fu">::</span><span class="va">biovars</span>, </span>
<span>                           <span class="va">present_prec</span>, </span>
<span>                           <span class="va">present_tmin</span>, </span>
<span>                           <span class="va">present_tmax</span>,</span>
<span>                           SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Present_bioclim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="fu">reduce</span><span class="op">(</span><span class="va">present_bio_list</span>, <span class="va">`+`</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">present_bio_list</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="tab-pane" id="past-1" role="tabpanel" aria-labelledby="past-1-tab">

<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">past_bio_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="fu">dismo</span><span class="fu">::</span><span class="va">biovars</span>, </span>
<span>                   <span class="va">past_prec</span>, </span>
<span>                   <span class="va">past_tmin</span>, </span>
<span>                   <span class="va">past_tmax</span>, </span>
<span>                   SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="occurrence-data">Occurrence data<a class="anchor" aria-label="anchor" href="#occurrence-data"></a>
</h2>
<p>To illustrate SDMs with our dataset, we used occurrences of the
species <em>Bubas bison</em> from the <code>Beetles</code> dataset in
the <code>KnowBR</code> package. Pseudo-absences points were generated
randomly. We also loaded a topography mask to ensure that all points
(i.e. presences and pseudo-absences) are within the designated land
area. Once the required data had been collated, we extracted values from
the bioclimatic variables of the selected variables at the occurrence
(e.g. presences and pseudo-absences) locations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Beetles"</span>, package <span class="op">=</span> <span class="st">"KnowBR"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">presences</span> <span class="op">&lt;-</span> <span class="va">Beetles</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"Bubas bison"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Longitude</span>, <span class="va">Latitude</span><span class="op">)</span></span>
<span></span>
<span><span class="va">topo14_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, </span>
<span>                           <span class="st">"topo14_mask.tif"</span>, </span>
<span>                           package <span class="op">=</span> <span class="st">"dsclimtools"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>               <span class="fu">raster</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">absences</span> <span class="op">&lt;-</span> <span class="fu">randomPoints</span><span class="op">(</span><span class="va">topo14_mask</span>, </span>
<span>                         <span class="fl">400</span>, </span>
<span>                         <span class="va">presences</span><span class="op">)</span></span>
<span></span>
<span><span class="va">presvals</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu">extract</span><span class="op">(</span><span class="va">Present_bioclim</span>, </span>
<span>                            <span class="va">presences</span>, </span>
<span>                            na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">presvals</span> <span class="op">&lt;-</span> <span class="va">presvals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">absvals</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu">extract</span><span class="op">(</span><span class="va">Present_bioclim</span>, </span>
<span>                           <span class="va">absences</span>, </span>
<span>                           na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">absvals</span> <span class="op">&lt;-</span> <span class="va">absvals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">presvals</span><span class="op">)</span><span class="op">)</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">absvals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sdmdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pb</span>, </span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">presvals</span>, <span class="va">absvals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="glm-calibration">GLM calibration<a class="anchor" aria-label="anchor" href="#glm-calibration"></a>
</h2>
<p>We calibrated a Generalized Linear Model (GLM) for the occurrence in
relation to the bioclimatic variables.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">pb</span> <span class="op">~</span> <span class="va">bio1</span> <span class="op">+</span> <span class="va">bio5</span> <span class="op">+</span> <span class="va">bio6</span> <span class="op">+</span> <span class="va">bio7</span> <span class="op">+</span> <span class="va">bio8</span> <span class="op">+</span> <span class="va">bio12</span> <span class="op">+</span> <span class="va">bio16</span> <span class="op">+</span> <span class="va">bio17</span>, </span>
<span>              data <span class="op">=</span> <span class="va">sdmdata</span>, </span>
<span>              family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2 tabset tabset-pills">
<h2 class="tabset tabset-pills" id="model-projection-under-current-conditions">Model projection under current
conditions<a class="anchor" aria-label="anchor" href="#model-projection-under-current-conditions"></a>
</h2>
<p>Then, we can project the model over current conditions and plot it
both in its continuous or binary form. For the binary prediction, we
threshold the prediction using the 0.7 threshold.</p>


<ul class="nav nav-pills" id="model-projection-under-current-conditions" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#continuous-prediction" id="continuous-prediction-tab" type="button" role="tab" aria-controls="continuous-prediction" aria-selected="true" class="active nav-link">Continuous prediction</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#binary-prediction" id="binary-prediction-tab" type="button" role="tab" aria-controls="binary-prediction" aria-selected="false" class="nav-link">Binary prediction</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="continuous-prediction" role="tabpanel" aria-labelledby="continuous-prediction-tab">

<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">present_prediction</span> <span class="op">&lt;-</span> <span class="va">Present_bioclim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu">raster</span><span class="fu">::</span><span class="fu">mask</span><span class="op">(</span><span class="va">topo14_mask</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">present_prediction</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, </span>
<span>                  y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                  fill <span class="op">=</span> <span class="va">layer</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>        axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="float">
<img src="figures%2Fa4%2Fpresent_map.png" width="640" alt="Figure 3. Current predicted distribution."><div class="figcaption">Figure 3. Current predicted distribution.</div>
</div>
</div>
<div class="tab-pane" id="binary-prediction" role="tabpanel" aria-labelledby="binary-prediction-tab">

<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">present_prediction</span> <span class="op">&lt;-</span> <span class="va">Present_bioclim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu">raster</span><span class="fu">::</span><span class="fu">mask</span><span class="op">(</span><span class="va">topo14_mask</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">present_prediction</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>th_layer <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">layer</span> <span class="op">&gt;=</span> <span class="fl">0.7</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                              <span class="va">layer</span> <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, </span>
<span>                  y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                  fill <span class="op">=</span> <span class="va">th_layer</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>        axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="float">
<img src="figures%2Fa4%2Fbinary_present_map.png" width="640" alt="Figure 4. Current predicted distribution."><div class="figcaption">Figure 4. Current predicted distribution.</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="model-projection-under-past-conditions">Model projection under past conditions<a class="anchor" aria-label="anchor" href="#model-projection-under-past-conditions"></a>
</h2>
<p>Now, we use the model to project under past climate conditions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">past_prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">101</span><span class="op">)</span>, </span>
<span>                    FUN <span class="op">=</span> <span class="va">model.projection</span>, </span>
<span>                    <span class="va">past_bio_list</span>, </span>
<span>                    <span class="va">topo14_mask</span>, </span>
<span>                    <span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">past_prediction</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="op">-</span><span class="fl">14500</span><span class="op">:</span><span class="op">-</span><span class="fl">14400</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">past_prediction</span>, </span>
<span>                    FUN <span class="op">=</span> <span class="va">as.data.frame</span>, </span>
<span>                    xy <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>             <span class="fu">reshape2</span><span class="fu">::</span><span class="fu">melt</span><span class="op">(</span>id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"layer"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">L1</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">past_prediction</span><span class="op">$</span><span class="va">L1</span> <span class="op">&lt;-</span> <span class="va">past_prediction</span><span class="op">$</span><span class="va">L1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">years_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">14500</span>, <span class="op">-</span><span class="fl">14400</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">past_prediction</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">years_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>FUN <span class="op">=</span> <span class="va">last</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_prediction</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="va">past_prediction</span><span class="op">$</span><span class="va">year</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2 tabset tabset-pills">
<h2 class="tabset tabset-pills" id="plotting-past-projections">Plotting past projections<a class="anchor" aria-label="anchor" href="#plotting-past-projections"></a>
</h2>
<p>Furthermore, we provide a graphical illustration of the fluctuations
in the potential distribution of the species over past conditions.
Additionally, we have calculated the pixel mean value for the whole
period and identified those which have a mean value greater than
0.7.</p>


<ul class="nav nav-pills" id="plotting-past-projections" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#dynamic-projection" id="dynamic-projection-tab" type="button" role="tab" aria-controls="dynamic-projection" aria-selected="true" class="active nav-link">Dynamic projection</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#binary-mean-projection" id="binary-mean-projection-tab" type="button" role="tab" aria-controls="binary-mean-projection" aria-selected="false" class="nav-link">Binary mean projection</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="dynamic-projection" role="tabpanel" aria-labelledby="dynamic-projection-tab">

<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span></span>
<span>  <span class="va">past_prediction</span>, </span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>,</span>
<span>      y <span class="op">=</span> <span class="va">y</span>, </span>
<span>      fill <span class="op">=</span> <span class="va">layer</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Year: {current_frame}"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>        axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>gganimate.dev_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">600</span>, </span>
<span>                                  height <span class="op">=</span> <span class="fl">400</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gganim</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span> </span>
<span>  <span class="fu">transition_manual</span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">animate</span><span class="op">(</span><span class="va">gganim</span>, </span>
<span>        duration <span class="op">=</span> <span class="fl">60</span>, </span>
<span>        width <span class="op">=</span> <span class="fl">600</span>, </span>
<span>        height <span class="op">=</span> <span class="fl">400</span>, </span>
<span>        renderer <span class="op">=</span> <span class="fu">gifski_renderer</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fa4%2Fpast_timeseries.gif" alt="Figure 5. Dynamic projection of the model under past conditions."><div class="figcaption">Figure 5. Dynamic projection of the model under
past conditions.</div>
</div>
</div>
<div class="tab-pane" id="binary-mean-projection" role="tabpanel" aria-labelledby="binary-mean-projection-tab">

<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mean_data</span> <span class="op">&lt;-</span> <span class="va">past_prediction</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">layer</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>th_layer <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">mean_layer</span> <span class="op">&gt;=</span> <span class="fl">0.7</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                              <span class="va">mean_layer</span> <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mean_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, </span>
<span>                  y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                  fill <span class="op">=</span> <span class="va">th_layer</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>        axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="figures%2Fa4%2Fbinary_past_map.png" alt="Figure 6. Thresholded (binary) mean predicted distribution under past climate conditions.">
{width=“631”}</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Diego Nieto-Lugilde, Daniel Romera-Romera.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
